rule all_unassign:
    input:
        TARGET_UNASSIGN

rule unassign-to-qza:
    input:
        DENOISE_DIR + "/representative_seq_fasta/dna-sequences.fasta",
    output:
        DENOISE_DIR + "/representative_seq_fasta/dna-sequences.qza"
    shell:
        """
        qiime tools import \
        --type 'FeatureData[Sequence]' \
        --input-path {input} \
        --output-path {output}
        """

rule run_unassign:
    input:
        DENOISE_DIR + "/representative_seq_fasta/dna-sequences.qza"
    params:
        unassigner_species_fp = config["unassign"]["unassigner_species_fp"],
        outdir = DENOISE_DIR + "/representative_seq_fasta/unassigned"
    output:
        DENOISE_DIR + "/representative_seq_fasta/unassigned/unassigner_output.tsv"
    shell:
        """
        if [[ -f {params.unassigner_species_fp} ]]; then
            qiime unassigner unassign \
            --p-type-strain-fasta {params.unassigner_species_fp} \
            --o-output-dir {params.outdir} \
            --i-seqs {input}
        else
            qiime unassigner unassign \
            --output-dir {params.outdir} \
            --i-seqs {input}
        fi
        """
